#!/usr/bin/env bash

set -eu

if [[ -f ~/.config/strava_offline/config.yaml && -f ~/.config/strava_offline/token.json ]]; then
	if nmcli-online || { sleep 30; nmcli-online; }; then
		strava-offline sqlite
	fi
fi

d=$(date -d "${1:-yesterday}" +%F)
COLUMNS=100 liskin-arbtt-stats activity-chart "$d" \
	| mail -s "arbtt-stats $d" -a "From: $USER@localhost" "$USER"@localhost

# avoid killing forked exim4 trying to deliver results
sleep 2
