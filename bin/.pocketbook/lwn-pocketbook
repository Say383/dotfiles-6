#!/bin/bash

set -eu -o pipefail

base="$(dirname "$(readlink -f "$0")")"

out=${1:-lwn-$(date +%F).epub}

env \
CALIBRE_OVERRIDE_LANG=C \
${2+LWN_EDITION="$2"} \
ebook-convert "$base/lwn_weekly.recipe" "$out" \
	--output-profile=generic_eink_hd \
	--change-justification=justify \
	--transform-css-rules="$base/lwn_weekly-rules.txt" \
	--search-replace="$base/lwn_weekly-searchreplace.txt" \
	--embed-all-fonts \
	--disable-font-rescaling \
	${DEBUG+--debug-pipeline=dbg}
