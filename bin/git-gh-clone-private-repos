#!/usr/bin/env bash

set -eu -o pipefail

function o { printf -->&2 "%s:%s\\n" "${0##*/}" "$(printf " %q" "$@")"; "$@"; }
function oo { printf -->&2 "%s: %s\\n" "${0##*/}" "$*"; }

org="${1:?org argument expected}"

gh api --paginate --jq '.[].full_name' orgs/"$org"/repos?type=private \
| while read -r repo; do
	if [[ -d "${repo#*/}" ]]; then
		oo "$repo" exists
	else
		o git clone https://github.com/"$repo"
	fi
done
